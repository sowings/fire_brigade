<form class="formsearch">
  <label>Bucket Count vs. Maximum Count</label>

  <row>
    <html>
<div id="fire_brigade_help">
The family of views in the Retention menu is aimed at helping
administrators visualize and thereby tune various retention parameters
for their indexed data. General information about retention settings
can be found in the Splunk documentation for <a
href="http://docs.splunk.com/Documentation/Splunk/4.3.6/Admin/Setaretirementandarchivingpolicy">version
4.3.x here</a> or <a
href="http://docs.splunk.com/Documentation/Splunk/latest/Indexer/Setaretirementandarchivingpolicy">version
5.0.x here</a>.
<p />
This dashboard is focused on limits based upon the <i>count</i> of
buckets within the index. Only buckets in the <i>hot</i> and
<i>warm</i> states can be limited by count.
</div>
    </html>
  </row>

  <fieldset>
    <input type="dropdown" token="host" searchWhenChanged="true">
      <label>Host</label>
      <populatingSearch fieldForValue="host" fieldForLabel="host">| inputlookup fb_collected_hostnames</populatingSearch>
    </input>
    <input type="dropdown" token="index" searchWhenChanged="true">
      <label>Index</label>
      <populatingSearch fieldForValue="orig_index" fieldForLabel="orig_index">| inputlookup fb_collected_indexes</populatingSearch>
    </input>
  </fieldset>

  <row>
    <single>
      <title>Hot Bucket Count</title>
      <option name="field">count</option>
      <earliestTime>@d</earliestTime>
      <searchString>state="hot" `_fb_summary_recs($host$, $index$)`
| dedup path
| stats dc(id) AS count</searchString>
    </single>
    <single>
      <title>Warm Bucket Count</title>
      <option name="field">count</option>
      <earliestTime>@d</earliestTime>
      <searchString>state="warm" `_fb_summary_recs($host$, $index$)`
| dedup path
| stats dc(id) AS count</searchString>
    </single>
  </row>


  <row>
    <single>
      <title>Hot Bucket Limit</title>
      <option name="field">maxHotBuckets</option>
      <searchString>| `_fb_rest_index_config($host$, $index$)`</searchString>
    </single>
    <single>
      <title>Warm Bucket Limit</title>
      <option name="field">maxWarmDBCount</option>
      <searchString>| `_fb_rest_index_config($host$, $index$)`</searchString>
    </single>
  </row>

  <row>
    <chart>
      <title>Usage vs. Configured Maximum Count (Hot / Warm Only)</title>
      <option name="charting.chart">line</option>
      <option name="charting.chart.nullValueMode">connect</option>
      <option name="charting.axisTitleX.text">Time</option>
      <earliestTime>-30d@d</earliestTime>
      <searchString>
state="hot" OR state="warm" `_fb_summary_recs($host$, $index$)`
| bucket _time span=1d
| dedup path
| join type=left index
 [ | `_fb_rest_index_config($host$, $index$)` ]
| eval limit=if(state=="hot", maxHotBuckets, if(state=="warm", maxWarmDBCount, 0))
| timechart span=1d dc(id) AS "Count", first(limit) AS Limit by state
      </searchString>
    </chart>
  </row>
</form>
