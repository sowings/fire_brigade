<form class="formsearch">
  <label>Usage vs. Size Limit(s)</label>

  <row>
    <html>
<div id="fire_brigade_help">
The family of views in the Retention menu is aimed at helping
administrators visualize and thereby tune various retention parameters
for their indexed data. General information about retention settings
can be found in the Splunk documentation for <a
href="http://docs.splunk.com/Documentation/Splunk/4.3.6/Admin/Setaretirementandarchivingpolicy">version
4.3.x here</a> or <a
href="http://docs.splunk.com/Documentation/Splunk/latest/Indexer/Setaretirementandarchivingpolicy">version
5.0.x here</a>.
<p />
This particular dashboard shows both index usage, as well as retention
polices based on <strong>size</strong>. This is a very common means of
constraining the overall disk usage of a Splunk index by setting a
limit on how much space it can use.
<p />
The first row of values show the current usage of the index in its
three main storage locations. The <em>Home Path Usage</em> panel
reflects the amount of space used by buckets in both the <i>hot</i>
and <i>warm</i> states. The space limitation set for this path group
is optional, and is referenced as <code>homePath.maxDataSizeMB</code>
in <code>indexes.conf</code>. Similar to the the <i>Home Path</i>, the
<em>Cold Path Usage</em> reflects the usage for buckets in the
<i>cold</i> state. The corresponding limit is
<code>coldPath.maxDataSizeMB</code>. In the right-hand column is
displayed the <em>Thawed Path Usage</em>; this location is for index
buckets which have been restored from the archive path. These
<strong>are not</strong> subject to any retention policy, and must be
managed manually.
<p />
In the second row, the right-hand panel reflects the configured limit
for the combined disk usage of buckets in all states (except <i>thawed</i>).
This corresponds to the <code>maxTotalDataSizeMB</code> parameter in
<code>indexes.conf</code>.
<p />
</div>
    </html>
  </row>

  <fieldset>
    <input type="dropdown" token="host" searchWhenChanged="true">
      <label>Host</label>
      <populatingSearch fieldForValue="host" fieldForLabel="host">| inputlookup fb_collected_hostnames</populatingSearch>
    </input>
    <input type="dropdown" token="index" searchWhenChanged="true">
      <label>Index</label>
      <populatingSearch fieldForValue="orig_index" fieldForLabel="orig_index">| inputlookup fb_collected_indexes</populatingSearch>
    </input>
  </fieldset>

  <row>
    <single>
      <title>Home Path Usage</title>
      <option name="field">homeUsage</option>
      <earliestTime>@d</earliestTime>
      <searchString>state="hot" OR state="warm" `_fb_summary_recs($host$, $index$)`
| dedup path | stats sum(sizeOnDiskMB) AS homeUsage
| `_fb_mbytes_pretty(homeUsage)`
      </searchString>
    </single>
    <single>
      <title>Cold Path Usage</title>
      <option name="field">coldUsage</option>
      <earliestTime>@d</earliestTime>
      <searchString>state="cold" `_fb_summary_recs($host$, $index$)`
| dedup path
| stats sum(sizeOnDiskMB) AS coldUsage
| `_fb_mbytes_pretty(coldUsage)`
      </searchString>
    </single>
    <single>
      <title>Thawed Path Usage</title>
      <option name="field">thawedUsage</option>
      <earliestTime>@d</earliestTime>
      <searchString>state="thawed" `_fb_summary_recs($host$, $index$)`
| dedup path
| stats sum(sizeOnDiskMB) AS thawedUsage
| `_fb_mbytes_pretty(thawedUsage)`
      </searchString>
    </single>
  </row>

  <row>
    <single>
      <title>Configured Home Space Limit</title>
      <option name="field">homePath_maxDataSizeMB</option>
      <searchString>| `_fb_rest_index_config($host$, $index$)`
| rename homePath.maxDataSizeMB AS homeMax
| `_fb_mbytes_pretty(homeMax)`
      </searchString>
    </single>
    <single>
      <title>Configured Cold Space Limit</title>
      <option name="field">coldMax</option>
      <searchString>| `_fb_rest_index_config($host$, $index$)`
| rename coldPath.maxDataSizeMB AS coldMax
| `_fb_mbytes_pretty(coldMax)`
      </searchString>
    </single>
    <single>
      <title>Configured Total Space Limit</title>
      <option name="field">maxTotalDataSizeMB</option>
      <searchString>| `_fb_rest_index_config($host$, $index$)`
| `_fb_mbytes_pretty(maxTotalDataSizeMB)`
      </searchString>
    </single>
  </row>

  <row>
    <chart>
      <title>Usage vs. Configured Maximum Size</title>
      <option name="charting.chart">line</option>
      <option name="charting.chart.nullValueMode">connect</option>
      <option name="charting.axisTitleX.text">Time</option>
      <option name="charting.axisTitleY.text">MBytes</option>
      <earliestTime>-30d@d</earliestTime>
      <searchString>
`_fb_summary_recs($host$, $index$)`
| eval state=if(state=="hot" OR state=="warm", "homePath", if(state=="cold", "coldPath", state))
| bucket _time span=1d
| stats max(sizeOnDiskMB) AS sizeOnDiskMB by _time, path, state, index
| join type=left index
 [ | `_fb_rest_index_config($host$, $index$)` ]
| eval limit=if(state=="homePath", coalesce(homePath.maxDataSizeMB, maxTotalDataSizeMB), if(state=="cold", coalesce(coldPath.maxDataSizeMB, maxTotalDataSizeMB), 0))
| timechart span=1d sum(sizeOnDiskMB) AS "Disk Usage", first(limit) AS Limit by state

      </searchString>
    </chart>
  </row>

  <row>
    <chart>
      <title>Day-on-Day Index Growth (Last 30 Days)</title>
      <option name="charting.chart">line</option>
      <option name="charting.chart.nullValueMode">connect</option>
      <option name="charting.axisTitleX.text">Time</option>
      <option name="charting.axisTitleY.text">MBytes</option>
      <earliestTime>-30d@d</earliestTime>
      <searchString>`_fb_summary_recs($host$, $index$)`
| bucket span=1d _time
| stats max(sizeOnDiskMB) AS sizeOnDiskMB by _time, id, path
| stats sum(sizeOnDiskMB) AS Usage by _time
| delta Usage AS Growth
| eventstats avg(Growth) AS avg
| timechart span=1d first(Growth) AS "Daily Growth", first(avg) AS "Average Daily Growth"
      </searchString>
    </chart>
  </row>

</form>
