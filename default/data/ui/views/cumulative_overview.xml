<dashboard>
  <label>Quick Overview</label>

  <row>
    <html>
<div id="fire_brigade_help">
<p />
This dashboard is intended to show the overall status of the
indexers in the Splunk environment.
<p />
The values reflected in the <em>Monitored Index Count</em> and
<em>Monitored Disk Usage</em> sections come from the data collected by
the <code>dbinspect</code> command through either this application, or
TA-fire_brigade. The list of indexes to be monitored is contained in
the lookup table <b>monitored_indexes.csv</b> in the respective
application.
<p />
The sections with <em>Total Discovered ...</em> in the title are using
calls to the REST API (see <a
href="http://docs.splunk.com/Documentation/Splunk/latest/RESTAPI/RESTIntro">here</a> for more information) to
get <i>live</i> values of these quantities.
</div>
    </html>
  </row>

  <row>
    <single>
      <title>Monitored Index Count</title>
      <option name="field">count</option>
      <earliestTime>@d</earliestTime>
      <searchString>| inputlookup monitored_indexes.csv | stats count</searchString>
    </single>

    <single>
      <title>Monitored Disk Usage (from dbinspect)</title>
      <option name="field">dbinspect_size</option>
      <earliestTime>@d</earliestTime>
      <!-- Use path as a poor man's dedup -->
      <searchString>`_fb_summary_recs(*)`
| bucket span=1d _time
| stats max(sizeOnDiskMB) AS sizeOnDiskMB by _time, host, index, path, id
| stats sum(sizeOnDiskMB) AS dbinspect_size
| `_fb_mbytes_pretty(dbinspect_size)`
</searchString>
    </single>

    <single>
      <title>Total Monitored Raw Size (from dbinspect)</title>
      <option name="field">rawBytes</option>
      <earliestTime>@d</earliestTime>
      <searchString>`_fb_summary_recs(*)` | dedup id, path, state
| stats sum(rawSize) AS rawBytes
| `_fb_bytes_pretty(rawBytes)`
      </searchString>
    </single>
  </row>

  <row>
    <single>
      <title>Total Discovered Index Count</title>
      <option name="field">count</option>
      <searchString>| rest /services/data/indexes count=0 | search disabled=0 title!=_blocksignature title!=_thefishbucket| stats dc(title) AS count</searchString>
    </single>

    <single>
      <title>Total Discovered Disk Usage (from REST)</title>
      <option name="field">total_size</option>
      <searchString>| rest /services/data/indexes
| stats sum(currentDBSizeMB) AS total_size
| `_fb_mbytes_pretty(total_size)`
       </searchString>
    </single>

    <single>
      <title>Overall Compression Percentage</title>
      <option name="field">comp_percent</option>
      <searchString>`_fb_summary_recs(*)` | dedup host, path
| stats sum(rawSize) AS rawBytes, sum(sizeOnDiskMB) AS diskTotalinMB
| eval rawTotalinMB=round(rawBytes / 1024 / 1024, 0)
| `_fb_get_comp_percent`</searchString>
    </single>

  </row>

  <row>
    <chart>
      <title>Monitored Indexes by Host</title>
      <option name="charting.chart">column</option>
      <option name="charting.chart.stackMode">stacked</option>
      <option name="charting.axisTitleX.text">Host</option>
      <option name="charting.axisTitleY.text">MBytes</option>
      <option name="charting.seriesColors">[0x416E79,0x967711,0x823825,0x59425A,0x94571A,0x5C7424,0x5C5433,0x85516A,0x324969,0x866523,0x40521D,0x602935,0xA7D4DF,0xFCDD77,0xE89E8B,0xBFA8C0,0xFABD80,0xC2DA8A,0xC2BA99,0xEBB7D0,0x98AFCF,0xECCB89,0xA6B883,0xC68F9B]</option>
      <earliestTime>@d</earliestTime>
      <searchString>`_fb_summary_recs(*)`
| bucket span=1d _time
| stats max(sizeOnDiskMB) AS sizeOnDiskMB by _time, host, index, id
| chart sum(sizeOnDiskMB) AS MBytes OVER host BY index
      </searchString>
      <drilldown>
        <link><![CDATA[
/app/fire_brigade/index_detail?form.host=$click.value$&form.index=$click.name2$]]></link>
      </drilldown>
    </chart>

    <chart>
      <title>Monitored Indexing Space Over Time (last 30 days)</title>
      <option name="charting.chart">area</option>
      <option name="charting.chart.nullValueMode">connect</option>
      <option name="charting.legend.placement">none</option>
      <option name="charting.axisTitleX.text">Time</option>
      <option name="charting.axisTitleY.text">MBytes</option>
      <option name="charting.seriesColors">[0x70A65C]</option>
      <!-- The stats command below is a form of dedup -->
      <earliestTime>-30d@d</earliestTime>
      <searchString>`_fb_summary_recs(*)`
| bucket span=1d _time
| stats max(sizeOnDiskMB) AS sizeOnDiskMB by _time, host, index, id
| timechart sum(sizeOnDiskMB) AS MBytes
</searchString>
      <drilldown>
        <link>/app/fire_brigade/retention_size</link>
      </drilldown>
    </chart>
  </row>

</dashboard>
